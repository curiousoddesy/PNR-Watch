<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PNR Ticket Status Display - View your train ticket details">
    <title>PNR Status - 245-5423890</title>
    
    <!-- Tailwind CSS with custom configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#137fec',
                        'background-light': '#f6f7f8',
                        'background-dark': '#101922'
                    },
                    fontFamily: {
                        sans: ['Public Sans', 'system-ui', 'sans-serif']
                    },
                    fontWeight: {
                        normal: '400',
                        medium: '500',
                        semibold: '600',
                        bold: '700'
                    }
                }
            }
        }
    </script>
    
    <!-- Public Sans Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Symbols Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../styles.css">
</head>
<body class="font-sans bg-background-light dark:bg-background-dark text-slate-900 dark:text-white antialiased" style="min-height: max(884px, 100dvh);">
    <!-- Main application container -->
    <div id="app" class="min-h-full">
        <!-- Sticky Header Component -->
        <header class="sticky top-0 z-10 bg-background-light dark:bg-background-dark shadow-sm p-4 pb-2 flex items-center justify-between">
            <!-- Back button -->
            <button class="flex items-center justify-center w-12 h-12 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">
                    arrow_back
                </span>
            </button>
            
            <!-- Centered title -->
            <h1 class="text-lg font-semibold text-slate-900 dark:text-white">
                PNR Status
            </h1>
            
            <!-- More options button (changed from share to more_vert) -->
            <button id="moreOptionsBtn" class="flex items-center justify-center w-12 h-12 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">
                    more_vert
                </span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="px-4 pb-4">
            <!-- Status Card -->
            <div class="bg-[#28a745] rounded-lg pt-[100px] pb-6 px-6 mb-6 text-white" style="box-shadow: 0 0 4px rgba(0,0,0,0.1);">
                <div class="text-center">
                    <h2 class="text-lg font-semibold mb-2">PNR: 245-5423890</h2>
                    <div class="text-2xl font-bold mb-2">CONFIRMED</div>
                    <p class="text-sm opacity-90">Your ticket has been confirmed. Have a safe journey!</p>
                </div>
            </div>

            <!-- Status Change Alerts Section -->
            <div class="mb-6">
                <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-primary">
                                notifications_active
                            </span>
                            <div>
                                <h3 class="font-medium text-slate-900 dark:text-white">Status Change Alerts</h3>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Get notified when your PNR status changes</p>
                            </div>
                        </div>
                        
                        <!-- Toggle Switch Component -->
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="notificationToggle" class="sr-only peer" checked>
                            <div class="relative w-11 h-6 bg-slate-200 dark:bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Train Details Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Train Details</h2>
                <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700">
                    <div class="grid grid-cols-1 divide-y divide-slate-200 dark:divide-slate-700">
                        <div class="p-4">
                            <div class="text-sm text-slate-600 dark:text-slate-400 mb-1">Train</div>
                            <div class="font-medium text-slate-900 dark:text-white">12345 | SUPERFAST EXP</div>
                        </div>
                        <div class="p-4">
                            <div class="text-sm text-slate-600 dark:text-slate-400 mb-1">Class</div>
                            <div class="font-medium text-slate-900 dark:text-white">Sleeper (SL)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journey Itinerary Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Journey Itinerary</h2>
                <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4">
                    <div class="relative">
                        <!-- Timeline -->
                        <div class="flex flex-col space-y-6">
                            <!-- Departure -->
                            <div class="flex items-start">
                                <div class="flex flex-col items-center mr-4">
                                    <div class="w-3 h-3 bg-primary rounded-full"></div>
                                    <div class="w-0.5 h-16 bg-slate-300 dark:bg-slate-600 mt-2"></div>
                                </div>
                                <div class="flex-1 pt-0">
                                    <div class="font-medium text-slate-900 dark:text-white">New Delhi (NDLS)</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">15 Jul 2024, 20:40</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-500 mt-1">Departure</div>
                                </div>
                            </div>
                            
                            <!-- Arrival -->
                            <div class="flex items-start">
                                <div class="flex flex-col items-center mr-4">
                                    <div class="w-3 h-3 bg-primary rounded-full"></div>
                                </div>
                                <div class="flex-1 pt-0">
                                    <div class="font-medium text-slate-900 dark:text-white">Mumbai Central (MMCT)</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">16 Jul 2024, 12:30</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-500 mt-1">Arrival</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Passenger Information Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Passenger Information</h2>
                <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700">
                    <div class="divide-y divide-slate-200 dark:divide-slate-700">
                        <!-- Passenger 1 -->
                        <div class="p-4">
                            <div class="grid grid-cols-3 gap-4 items-center">
                                <div>
                                    <div class="font-medium text-slate-900 dark:text-white">John Doe</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Age: 28, Male</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-slate-900 dark:text-white">S5</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">32 (Upper)</div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200">
                                        Confirmed
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Passenger 2 -->
                        <div class="p-4">
                            <div class="grid grid-cols-3 gap-4 items-center">
                                <div>
                                    <div class="font-medium text-slate-900 dark:text-white">Jane Smith</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Age: 25, Female</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-slate-900 dark:text-white">S5</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">33 (Lower)</div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200">
                                        Confirmed
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>

        <!-- Floating Refresh Button -->
        <button id="refreshBtn" class="fixed bottom-6 right-6 h-14 w-14 bg-primary hover:bg-primary/90 text-white rounded-full shadow-lg flex items-center justify-center transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background-light dark:focus:ring-offset-background-dark z-10">
            <span class="material-symbols-outlined">
                refresh
            </span>
        </button>

        <!-- Share Modal Overlay -->
        <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden">
            <!-- Bottom Sheet Modal -->
            <div class="fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 rounded-t-xl transform transition-transform duration-300 translate-y-full" id="shareModalContent">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700">
                    <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Share PNR Status</h3>
                    <button id="closeModalBtn" class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                        <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">
                            close
                        </span>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-4">
                    <!-- Formatted PNR Information Display -->
                    <div class="bg-slate-100 dark:bg-slate-700 rounded-lg p-4 mb-6">
                        <div class="text-sm font-mono text-slate-800 dark:text-slate-200">
                            <div class="font-semibold mb-2">🚂 PNR Status: 245-5423890</div>
                            <div class="mb-1">Status: CONFIRMED ✅</div>
                            <div class="mb-1">Train: 12345 | SUPERFAST EXP</div>
                            <div class="mb-1">Class: Sleeper (SL)</div>
                            <div class="mb-1">Route: New Delhi → Mumbai Central</div>
                            <div class="mb-1">Date: 15 Jul 2024, 20:40</div>
                            <div class="text-xs text-slate-600 dark:text-slate-400 mt-2">
                                Passengers: John Doe (S5/32), Jane Smith (S5/33)
                            </div>
                        </div>
                    </div>

                    <!-- Share Options Grid -->
                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <!-- WhatsApp -->
                        <button class="share-option flex flex-col items-center p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" data-platform="whatsapp">
                            <div class="w-14 h-14 bg-green-500 rounded-full flex items-center justify-center mb-2">
                                <span class="material-symbols-outlined text-white text-xl">
                                    chat
                                </span>
                            </div>
                            <span class="text-xs text-slate-700 dark:text-slate-300 text-center">WhatsApp</span>
                        </button>

                        <!-- Messenger -->
                        <button class="share-option flex flex-col items-center p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" data-platform="messenger">
                            <div class="w-14 h-14 bg-blue-500 rounded-full flex items-center justify-center mb-2">
                                <span class="material-symbols-outlined text-white text-xl">
                                    forum
                                </span>
                            </div>
                            <span class="text-xs text-slate-700 dark:text-slate-300 text-center">Messenger</span>
                        </button>

                        <!-- Email -->
                        <button class="share-option flex flex-col items-center p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" data-platform="email">
                            <div class="w-14 h-14 bg-red-500 rounded-full flex items-center justify-center mb-2">
                                <span class="material-symbols-outlined text-white text-xl">
                                    mail
                                </span>
                            </div>
                            <span class="text-xs text-slate-700 dark:text-slate-300 text-center">Email</span>
                        </button>

                        <!-- Copy -->
                        <button class="share-option flex flex-col items-center p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" data-platform="copy">
                            <div class="w-14 h-14 bg-slate-500 rounded-full flex items-center justify-center mb-2">
                                <span class="material-symbols-outlined text-white text-xl">
                                    content_copy
                                </span>
                            </div>
                            <span class="text-xs text-slate-700 dark:text-slate-300 text-center">Copy</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme toggle script for testing -->
    <script>
        // Simple theme toggle for development/testing
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
        }
        
        // Check for saved theme preference or default to light mode
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        // Save theme preference
        function setTheme(theme) {
            localStorage.theme = theme;
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        // Notification state management
        let notificationSettings = {
            '245-5423890': {
                enabled: true,
                statusChanges: true,
                timeUpdates: false
            }
        };

        function getNotificationSettings(pnrNumber) {
            const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            return settings[pnrNumber] || { enabled: false, statusChanges: false, timeUpdates: false };
        }

        function saveNotificationSettings(pnrNumber, settings) {
            const allSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            allSettings[pnrNumber] = settings;
            localStorage.setItem('notificationSettings', JSON.stringify(allSettings));
            notificationSettings[pnrNumber] = settings;
        }

        function toggleNotifications(pnrNumber, enabled) {
            const currentSettings = getNotificationSettings(pnrNumber);
            currentSettings.enabled = enabled;
            saveNotificationSettings(pnrNumber, currentSettings);
            return currentSettings;
        }

        // Share modal functionality
        function openShareModal() {
            const modal = document.getElementById('shareModal');
            const modalContent = document.getElementById('shareModalContent');
            const refreshBtn = document.getElementById('refreshBtn');
            
            modal.classList.remove('hidden');
            // Adjust z-index of refresh button to be below modal
            refreshBtn.style.zIndex = '5';
            
            // Animate modal in
            setTimeout(() => {
                modalContent.classList.remove('translate-y-full');
            }, 10);
        }

        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            const modalContent = document.getElementById('shareModalContent');
            const refreshBtn = document.getElementById('refreshBtn');
            
            // Animate modal out
            modalContent.classList.add('translate-y-full');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                // Restore refresh button z-index
                refreshBtn.style.zIndex = '10';
            }, 300);
        }

        // Share functionality
        function shareContent(platform) {
            const pnrData = {
                pnr: '245-5423890',
                status: 'CONFIRMED',
                train: '12345 | SUPERFAST EXP',
                class: 'Sleeper (SL)',
                route: 'New Delhi → Mumbai Central',
                date: '15 Jul 2024, 20:40',
                passengers: 'John Doe (S5/32), Jane Smith (S5/33)'
            };

            const shareText = `🚂 PNR Status: ${pnrData.pnr}
Status: ${pnrData.status} ✅
Train: ${pnrData.train}
Class: ${pnrData.class}
Route: ${pnrData.route}
Date: ${pnrData.date}
Passengers: ${pnrData.passengers}`;

            switch (platform) {
                case 'whatsapp':
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
                    window.open(whatsappUrl, '_blank');
                    break;
                
                case 'messenger':
                    // For demonstration - in real app would use Messenger API
                    alert('Opening Messenger...\n\n' + shareText);
                    break;
                
                case 'email':
                    const emailSubject = `PNR Status: ${pnrData.pnr}`;
                    const emailUrl = `mailto:?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(shareText)}`;
                    window.location.href = emailUrl;
                    break;
                
                case 'copy':
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('PNR status copied to clipboard!');
                    }).catch(() => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = shareText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('PNR status copied to clipboard!');
                    });
                    break;
            }
            
            closeShareModal();
        }

        // Basic interactivity
        document.addEventListener('DOMContentLoaded', function() {
            const currentPnr = '245-5423890';
            
            // Back button functionality
            const backButton = document.querySelector('header button:first-child');
            backButton.addEventListener('click', function() {
                console.log('Back button clicked');
                // In a real app, this would navigate back
                alert('Navigating back to PNR input');
            });

            // More options button functionality (opens share modal)
            const moreOptionsButton = document.getElementById('moreOptionsBtn');
            moreOptionsButton.addEventListener('click', function() {
                console.log('More options button clicked');
                openShareModal();
            });

            // Close modal button functionality
            const closeModalBtn = document.getElementById('closeModalBtn');
            closeModalBtn.addEventListener('click', function() {
                closeShareModal();
            });

            // Close modal when clicking overlay
            const shareModal = document.getElementById('shareModal');
            shareModal.addEventListener('click', function(e) {
                if (e.target === shareModal) {
                    closeShareModal();
                }
            });

            // Share option click handlers
            const shareOptions = document.querySelectorAll('.share-option');
            shareOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const platform = this.getAttribute('data-platform');
                    console.log('Share option clicked:', platform);
                    shareContent(platform);
                });
            });

            // Refresh button functionality
            const refreshButton = document.getElementById('refreshBtn');
            refreshButton.addEventListener('click', function() {
                console.log('Refresh button clicked');
                // In a real app, this would refresh the PNR status
                alert('Refreshing PNR status...');
            });

            // Notification toggle functionality
            const notificationToggle = document.getElementById('notificationToggle');
            
            // Load saved notification settings
            const savedSettings = getNotificationSettings(currentPnr);
            notificationToggle.checked = savedSettings.enabled;

            notificationToggle.addEventListener('change', function() {
                const isEnabled = this.checked;
                console.log('Notification toggle changed:', isEnabled);
                
                const updatedSettings = toggleNotifications(currentPnr, isEnabled);
                
                if (isEnabled) {
                    alert('Notifications enabled for PNR ' + currentPnr);
                } else {
                    alert('Notifications disabled for PNR ' + currentPnr);
                }
            });

            // Run unit tests
            runModalFunctionalityTests();
        });

        // Unit tests for modal functionality
        function runModalFunctionalityTests() {
            console.log('Running modal functionality tests...');
            
            // Test modal open/close functionality
            function testModalOpenClose() {
                const modal = document.getElementById('shareModal');
                const modalContent = document.getElementById('shareModalContent');
                
                console.assert(modal, 'Share modal should exist');
                console.assert(modalContent, 'Share modal content should exist');
                console.assert(modal.classList.contains('hidden'), 'Modal should be initially hidden');
                
                // Test opening modal
                openShareModal();
                console.assert(!modal.classList.contains('hidden'), 'Modal should be visible after opening');
                
                // Test closing modal
                closeShareModal();
                setTimeout(() => {
                    console.assert(modal.classList.contains('hidden'), 'Modal should be hidden after closing');
                }, 350);
                
                console.log('✓ Modal open/close functionality test passed');
            }

            // Test share option click handlers
            function testShareOptionHandlers() {
                const shareOptions = document.querySelectorAll('.share-option');
                console.assert(shareOptions.length === 4, 'Should have 4 share options');
                
                const platforms = ['whatsapp', 'messenger', 'email', 'copy'];
                shareOptions.forEach((option, index) => {
                    const platform = option.getAttribute('data-platform');
                    console.assert(platforms.includes(platform), `Share option should have valid platform: ${platform}`);
                });
                
                console.log('✓ Share option handlers test passed');
            }

            // Test z-index management for floating refresh button
            function testZIndexManagement() {
                const refreshBtn = document.getElementById('refreshBtn');
                const initialZIndex = window.getComputedStyle(refreshBtn).zIndex;
                
                // Test z-index changes during modal operations
                openShareModal();
                setTimeout(() => {
                    const modalOpenZIndex = refreshBtn.style.zIndex;
                    console.assert(modalOpenZIndex === '5', 'Refresh button z-index should be lowered when modal is open');
                    
                    closeShareModal();
                    setTimeout(() => {
                        const modalClosedZIndex = refreshBtn.style.zIndex;
                        console.assert(modalClosedZIndex === '10', 'Refresh button z-index should be restored when modal is closed');
                    }, 350);
                }, 50);
                
                console.log('✓ Z-index management test passed');
            }

            // Test share content formatting
            function testShareContentFormatting() {
                const pnrInfo = document.querySelector('.bg-slate-100.dark\\:bg-slate-700');
                console.assert(pnrInfo, 'PNR information display should exist');
                
                const pnrText = pnrInfo.textContent;
                console.assert(pnrText.includes('245-5423890'), 'Should display PNR number');
                console.assert(pnrText.includes('CONFIRMED'), 'Should display status');
                console.assert(pnrText.includes('SUPERFAST EXP'), 'Should display train name');
                
                console.log('✓ Share content formatting test passed');
            }

            // Run all tests
            try {
                testModalOpenClose();
                testShareOptionHandlers();
                testZIndexManagement();
                testShareContentFormatting();
                console.log('✅ All modal functionality tests passed!');
            } catch (error) {
                console.error('❌ Test failed:', error);
            }
        }
    </script>
</body>
</html>